@page "/"
@using HelloTraveller.Services
@using HelloTraveller.Models
@inject IMyService _myService

@if (AllPhotos != null)
{
    <MudPaper>
        <TopicsComponent Topics="Topics" OnTopicClick="OnTopicCLick"/>

        <SearchComponent SearchTxtFieldId="search" OnSubmitReview="OnSearchClick"/>
    </MudPaper>
    <MudGrid>
        @foreach (var data in AllPhotos)
        {
            <CardViewComponent MyData="data"/>
        }
    </MudGrid>
}

@code{

    private string Search { get; set; }
    private MyModelClass MyData { get; set; }
    private Result[] AllPhotos { get; set; }
    private Topics[] Topics { get; set; }


    protected override async Task OnInitializedAsync()
    {
        try
        {
            AllPhotos = await _myService.GetAllData();
            Topics = await _myService.GetTopics();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }

    private async Task OnSearchClick(string searchTerm)
    {
        Search = searchTerm;
        await SearchPlace();
    }

    private async Task OnTopicCLick(string topic)
    {
        Search = topic;
        await SearchPlace();
    }

    private async Task SearchPlace()
    {
        try
        {
            MyData = await _myService.SearchPhotos(Search);
            AllPhotos = MyData.Results;
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }

}