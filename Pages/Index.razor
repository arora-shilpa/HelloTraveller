@page "/"
@using HelloTraveller.Services
@using HelloTraveller.Models
@inject ISnackbar _snackbar
@inject IMyService _myService

@if (AllPhotos != null)
{
    <MudGrid>
        <MudItem xs="12">
            <MudPaper Elevation="2">
                <TopicsComponent Topics="Topics" OnTopicClick="OnTopicCLick"/>

                <SearchComponent Search="@Search" OnSubmitReview="OnSearchClick"/>
            </MudPaper>
        </MudItem>

        @foreach (var data in AllPhotos)
        {
            <MudItem xs="12" sm="6" md="4" lg="3">
                <CardViewComponent MyData="data"/>
            </MudItem>
        }
    </MudGrid>
}

@code{

    private string Search { get; set; }
    private MyModelClass MyData { get; set; }
    private Result[] AllPhotos { get; set; }
    private Topics[] Topics { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            AllPhotos = await _myService.GetAllData();
            Topics = await _myService.GetTopics();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }

    private async Task OnSearchClick(string searchTerm)
    {
        Search = searchTerm;
        await SearchPlace();
    }

    private async Task OnTopicCLick(string topic)
    {
    //_snackbar.Add(topic);
        Search = topic;
        await SearchPlace();
    }

    private async Task SearchPlace()
    {
        try
        {
            MyData = await _myService.SearchPhotos(Search);
            AllPhotos = MyData.Results;
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }

}